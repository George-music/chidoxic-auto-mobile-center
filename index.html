<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Chidoxic Auto Mobile Center</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
        :root {
      --primary: #3c5edb;
      --secondary: #ffe36b;
      --accent: #ffefb4;
      --danger: #e53935;
      --bg: #f9fbff;
      --dark-bg: #18192e;
      --dark-card: #23243b;
      --text: #1a2233;
      --text-light: #e3e7fa;
      --shadow: 0 8px 38px #3c5edb13;
      --music: #ffd358;
    }
    html, body { margin:0; padding:0; min-height:100vh; }
    body {
      font-family: 'Inter', Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      transition: background .3s cubic-bezier(.77,0,.18,1), color .3s cubic-bezier(.77,0,.18,1);
    }
    body.dark {
      background: var(--dark-bg);
      color: var(--text-light);
    }
    .navbar {
      position: fixed;
      top: 0;
      left: 0; right: 0;
      margin: 0 auto;
      z-index: 1001;
      background: var(--primary);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 18px;
      height:71px;
      max-width: 100vw;
      border-radius: 0;
      box-shadow: 0 4px 32px #3c5edb44;
      animation: nav-float-in 0.7s cubic-bezier(.65,-0.02,.54,1.16);
      transition: height 0.3s;
    }
    @keyframes nav-float-in {
      0% { opacity: 0; transform: translateY(-40px) scale(0.95);}
      100% { opacity: 1; transform: translateY(0) scale(1);}
    }
    .logo {
      font-size:2.1em; font-weight:900; letter-spacing:1.5px; display:flex; align-items:center; gap:10px;
    }
    .logo span {
      background: var(--secondary);
      border-radius: 50%;
      color: var(--primary);
      width: 36px; height: 36px; display: inline-flex; align-items: center; justify-content: center; font-size: 1.2em;
      box-shadow: 0 1px 7px #fff5;
    }
    .nav-links {
      display: flex;
      align-items: center;
      gap: 0;
      transition: max-height 0.3s;
    }
    .nav-links button, .nav-links a {
      background: none; border: none; color: #fff; font-size: 1.04em; margin-left: 12px; cursor: pointer;
      font-weight:600; padding: 7px 16px; border-radius:6px; transition: background .2s, color .2s;
      text-decoration: none;
      display: inline-block;
    }
    .nav-links button:hover, .nav-links button.active, .nav-links a:hover {
      background: #fff; color: var(--primary);
    }
    .whatsapp-btn {
      background: #25d366;
      color: #fff;
      font-weight: 700;
      padding: 8px 17px;
      border-radius: 7px;
      font-size: 1.01em;
      margin-left: 14px;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 7px;
      transition: background .18s, color .18s;
      border: none;
      box-shadow: 0 2px 10px #25d36633;
    }
    .whatsapp-btn:hover { background: #1ebe5c; color: #fff;}
    .nav-toggle {
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      width: 38px;
      height: 38px;
      background: none;
      border: none;
      cursor: pointer;
      margin-left: 10px;
      z-index: 1500;
    }
    .nav-toggle span {
      display: block;
      width: 26px;
      height: 4px;
      margin: 4px 0;
      background: #fff;
      border-radius: 2px;
      transition: 0.3s;
    }
    @media (max-width: 900px) {
      .gallery {grid-template-columns:1fr;}
      .hero {padding:20px 5vw;}
      .admin-panel {width:98vw;}
      .modal {padding:20px 5vw 18px 5vw;}
    }
    @media (max-width: 700px) {
      .navbar {
        flex-direction: column;
        align-items: stretch;
        padding: 0;
        top: 0;
        height: auto;
        border-radius: 0;
        max-width: 100vw;
      }
      .logo {
        justify-content: center;
        padding: 13px 0;
      }
      .nav-toggle {
        display: flex;
        position: absolute;
        right: 16px;
        top: 16px;
      }
      .nav-links {
        flex-direction: column;
        align-items: stretch;
        justify-content: flex-start;
        width: 100%;
        background: var(--primary);
        padding-top: 0;
        padding-bottom: 8px;
        margin: 0;
        box-shadow: none;
        position: static;
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s;
      }
      .nav-links.open {
        max-height: 500px; /* enough to show all items */
        transition: max-height 0.4s;
      }
      .nav-links button, .nav-links a {
        margin: 0;
        margin-top: 6px;
        margin-left: 0;
        width: 90vw;
        max-width: 420px;
        align-self: center;
        font-size: 1.14em;
        padding: 13px 0;
        border-radius: 7px;
      }
      .whatsapp-btn {
        width: 90vw; max-width: 420px; margin: 10px auto 0 auto;
      }
      body { padding-top: 71px;} /* keep for hero spacing */
    }
    @media (max-width:600px) {
      .main { padding:0 2px;}
      .gallery {grid-template-columns:1fr;}
      .post-content {padding:13px 7px 10px 7px;}
      .hero { padding:12px 2vw;}
      .hero h1 { font-size:1.3em;}
      .modal {padding:12px 2vw 10px 2vw; min-width:unset;}
      .modal h2 { font-size:1.18em;}
      .admin-panel {width:99vw; padding:13px 2vw;}
      .random-btn {padding:12px 10vw;}
    }
    .hero {
      max-width: 900px; margin: 110px auto 30px auto; text-align: center; padding: 38px 16px 34px 16px;
      background: linear-gradient(100deg,#f9fbff 65%, #e3ebff 100%);
      border-radius: 18px; box-shadow: var(--shadow);
      display:flex; flex-direction:column; align-items:center;
      position:relative; overflow:hidden;
    }
    @media (max-width:700px) {
      .hero {margin-top: 20px;}
    }
    .hero h1 {
      font-size: 2.35em; color: var(--primary); font-weight: 800; letter-spacing: 1.2px;
      margin-bottom: 10px; line-height:1.13;
      text-shadow: 0 3px 16px #e3ebff;
      animation: popIn .7s cubic-bezier(.65,-0.02,.54,1.16) 1;
    }
    @keyframes popIn {
      0% {transform:scale(.8) translateY(30px); opacity:0;}
      80%{transform:scale(1.04) translateY(-2px);}
      100% {transform:scale(1) translateY(0); opacity:1;}
    }
    .hero p {
      color: #333; font-size: 1.13em; margin-bottom: 18px; font-weight: 500;
    }
    .hero .cta {
      margin-top: 6px; background: var(--primary); color: #fff; font-weight:700; border:none;
      padding:13px 33px; border-radius:9px; font-size:1.17em; cursor:pointer; box-shadow:0 3px 10px #3c5edb22;
      transition: background .2s, color .2s;
    }
    .hero .cta:hover { background: var(--text); color:var(--secondary);}
    .categories {
      display: flex; gap:12px; align-items:center; justify-content:center;
      margin:24px auto 0 auto; flex-wrap:wrap; max-width:800px;
    }
    .cat-btn {
      background: #fff; border:1.6px solid var(--primary); color: var(--primary); border-radius:21px;
      font-size: 1.01em; font-weight:700; padding:6px 22px; cursor:pointer;
      transition: background .14s, color .17s, border .17s;
      box-shadow: 0 1px 7px #3c5edb14;
    }
    .cat-btn.active, .cat-btn:hover { background: var(--primary); color: #fff;}
    .trending-bar {
      display: flex; gap:10px; align-items:center;
      background: var(--secondary); color: #b07300; font-weight:700;
      padding:10px 18px; border-radius:13px; max-width:750px; margin:24px auto 0 auto; font-size:1.04em;
      box-shadow: 0 1px 8px #ffe36b55;
    }
    .trending-bar span { margin-right:10px; }
    .trending-bar a { color:#c08c00; text-decoration:underline;}
    .gallery {
      display:grid; grid-template-columns:repeat(auto-fit,minmax(310px,1fr)); gap:32px;
      max-width:1200px; margin:34px auto 38px auto; padding:0 12px;
    }
    .card-anim { transition: box-shadow .22s, transform .21s cubic-bezier(.77,0,.18,1);}
    .post-card {
      background: #fff; border-radius:21px; box-shadow: var(--shadow);
      overflow:hidden; display:flex; flex-direction:column; position:relative;
      cursor:pointer; will-change: transform;
      transition: box-shadow .23s cubic-bezier(.77,0,.18,1), transform .23s cubic-bezier(.77,0,.18,1);
    }
    .post-card:hover { box-shadow:0 16px 48px #3c5edb33; transform:scale(1.028) rotateZ(-1.4deg);}
    .post-card:active { transform:scale(.98);}
    .post-card.dark { background: var(--dark-card);}
    .post-media {
      width:100%; background: #efeffb; display: flex; align-items:center; justify-content:center; min-height: 210px;
      position:relative;
      overflow:hidden;
    }
    .post-media img, .post-media video {
      max-width:100%; max-height:320px; border-radius:12px; margin: 0 auto; display:block; box-shadow:0 2px 9px #3c5edb12;
      transition:transform .19s cubic-bezier(.77,0,.18,1);
    }
    .post-card:hover .post-media img, .post-card:hover .post-media video { transform:scale(1.045);}
    .post-media video { background:#222; }
    .post-content { padding: 21px 18px 17px 18px; position:relative;}
    .post-title { font-weight:800; font-size:1.18em; color:var(--primary); }
    .post-desc { font-size:1.04em; color:#333; margin-top:7px; }
    .admin-panel {
      display:none; max-width:430px; margin:38px auto 0 auto; background:#fff; padding:28px 24px 25px 24px;
      border-radius:12px; box-shadow:0 3px 17px #3c5edb0d;
    }
    .admin-panel.active { display:block; }
    #postForm { display:flex; flex-direction:column; gap:13px; }
    #postForm input, #postForm textarea, #postForm select {
      font-size:1.08em; padding:11px 14px; border-radius:7px; border:1px solid #d1d9f4; background:#fafbff; resize:none;
    }
    #postForm button {
      background:var(--primary); color:#fff; font-weight:800; border:none; padding:13px 0; border-radius:7px; cursor:pointer;
      font-size:1.1em; letter-spacing:1px;
    }
    #logoutBtn {
      margin-top:13px; background:var(--danger); color:#fff; border:none; border-radius:7px; padding:11px 0; font-weight:700; cursor:pointer;
      font-size:1em;
    }
    #formMsg { color:var(--danger); margin-top:9px; min-height:23px; }
    .ad-slot { text-align:center; margin:20px auto; min-height:54px; color:#888; font-size:.99em; max-width:728px; }
    .random-btn {
      display:block; margin:30px auto 36px auto; background:var(--secondary); color:#b07300; font-weight:800; border:none;
      border-radius:11px; padding:16px 38px; font-size:1.13em; cursor:pointer; box-shadow:0 1px 7px #ffe36b44; transition: background .18s;
    }
    .random-btn:hover { background:#fff7c9;}
    .load-more-bar {display:flex; justify-content:center; margin:30px 0;}
    #loadMoreBtn {
      background:var(--primary); color:#fff; border:none; border-radius:9px; font-size:1.09em; font-weight:800;
      padding:13px 36px; cursor:pointer; letter-spacing:.5px;
    }
    #loadMoreBtn:hover { background: var(--text);}
    .modal-backdrop {
      position:fixed; left:0; top:0; width:100vw; height:100vh; background:rgba(26,34,51,0.18); z-index:999;
      display:flex; align-items:center; justify-content:center;
      animation: fadeIn .33s;
    }
    @keyframes fadeIn {from{opacity:0;}to{opacity:1;}}
    .modal {
      background:#fff; border-radius:19px; max-width:95vw; max-height:93vh; overflow-y:auto;
      box-shadow:0 16px 60px 0 rgba(49,103,230,0.22); padding:39px 39px 31px 39px; position:relative;
      min-width:320px; animation: popIn .6s cubic-bezier(.65,-0.02,.54,1.16) 1;
    }
    .modal .about-emoji {
      font-size:3.2em; filter: drop-shadow(0 3px 16px var(--accent));
      animation: bounce 1.5s infinite alternate cubic-bezier(.77,0,.18,1);
      margin-bottom:10px;
    }
    @keyframes bounce { 
      from{transform:translateY(0);}
      to{transform:translateY(-14px) scale(1.11);}
    }
    .modal .about-story {
      font-size:1.13em; margin-bottom:18px; font-weight:500; color:var(--primary);
    }
    .loading-overlay {
      position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(245,246,250,0.88); z-index:9999;
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      font-size:2.5em;
      color:var(--primary);
      transition: opacity .23s;
      pointer-events: none;
      user-select:none;
    }
    .loading-emoji {
      animation: spin 1.2s linear infinite;
      font-size:2.5em;
      margin-bottom:8px;
    }
    @keyframes spin {100%{transform: rotate(360deg);}}
    .loading-msg {font-size:1.14em; color:var(--primary);}
    body.dark .post-card { background: var(--dark-card); color:var(--text-light);}
    body.dark .post-title { color:var(--secondary);}
    body.dark .gallery { background: var(--dark-bg);}
    body.dark .hero h1 { color: var(--secondary);}
    body.dark .navbar { background: var(--dark-card);}
    body.dark .nav-links button, body.dark .nav-links a { color:var(--secondary);}
    body.dark .post-desc { color: var(--text-light);}
    body.dark .admin-panel {background: var(--dark-card); color:var(--text-light);}
    body.dark .modal {background: var(--dark-card);}
    body.dark .modal h2, body.dark .modal h3 {color: var(--secondary);}
    .music-btn {transition:background .2s, outline .2s;}
    /* Search bar styling */
    .search-bar {
      display: flex;
      justify-content: center;
      margin: 25px auto 0 auto;
      max-width: 620px;
    }
    .search-input {
      width: 100%;
      padding: 12px 16px;
      font-size: 1.11em;
      border: 1.5px solid #d1d9f4;
      border-radius: 8px;
      outline: none;
      transition: border-color 0.18s;
    }
    .search-input:focus {
      border-color: var(--primary);
    }
</style>
  
  <script src="https://cdn.jsdelivr.net/npm/appwrite@13.0.1"></script>
</head>
<body>
  <nav class="appbar">
    <span class="appbar-title">
      <img src="https://i.ibb.co/4W2DGKm/car-logo.png" class="logo" alt="Chidoxic Logo"/>
      Chidoxic Auto Mobile Center
    </span>
    <span class="appbar-btns">
      <button onclick="scrollToSection('gallery')">Browse Cars</button>
      <button onclick="showAbout()">About</button>
      <button onclick="showContact()">Contact</button>
      <button class="theme-toggle" id="themeToggle" title="Toggle dark/light mode">üåô</button>
      <button id="adminBtn" onclick="toggleAdminPanel()">Admin</button>
    </span>
  </nav>
  <main class="main">
    <section class="hero" id="hero">
      <div class="hero-content">
        <div class="hero-title">Find Your Dream Car</div>
        <div class="hero-desc">
          Explore a curated selection of the latest and greatest cars.<br>
          Modern UI. Smooth transitions. Details that matter.<br>
          <b>Discover your next ride today!</b>
        </div>
        <button class="hero-action" onclick="scrollToSection('gallery')">View Cars</button>
      </div>
      <div class="hero-img">
        <img src="https://images.unsplash.com/photo-1503736334956-4c8f8e92946d?auto=format&fit=crop&w=720&q=80" alt="Modern Car"/>
      </div>
    </section>
    <section class="car-list" id="gallery"></section>
    <section class="admin-panel" id="adminPanel">
      <div class="admin-title">Admin Panel</div>
      <form class="admin-form" id="adminForm" autocomplete="off">
        <div class="admin-msg" id="adminMsg"></div>
        <div class="admin-row">
          <label for="carTitle">Title</label>
          <input type="text" id="carTitle" required>
        </div>
        <div class="admin-row">
          <label for="carModel">Model Year</label>
          <input type="text" id="carModel" required>
        </div>
        <div class="admin-row">
          <label for="carPrice">Price</label>
          <input type="text" id="carPrice" required>
        </div>
        <div class="admin-row">
          <label for="carDesc">Description</label>
          <textarea id="carDesc" required></textarea>
        </div>
        <div class="admin-row">
          <label for="carMedia">Images & Video (drag and drop or click, min 2 files)</label>
          <div id="dragDropZone" class="drag-drop-zone">Drag & drop files here or click to select</div>
          <input type="file" id="carMedia" accept="image/*,video/*" multiple style="display:none" />
          <div class="file-list-preview" id="filePreview"></div>
        </div>
        <div class="admin-row">
          <label for="carFeatures">Features (comma separated)</label>
          <input type="text" id="carFeatures" required>
        </div>
        <button type="submit">Add Car</button>
      </form>
      <button class="admin-logout" id="adminLogout" onclick="logoutAdmin()">Logout</button>
      <div class="admin-list" id="adminList"></div>
    </section>
  </main>
  <div id="modal-root"></div>
  <footer class="footer">
    <div>
      &copy; <span id="year"></span> Chidoxic Auto Mobile Center.<br>
      <span class="footer-links">
        <a href="#" onclick="showTerms(event)">Terms &amp; Conditions</a> |
        <a href="#" onclick="showPrivacy(event)">Privacy Policy</a>
      </span><br>
      <span>Designed by <span class="designer">Supremeamer</span></span>
    </div>
  </footer>
  <script>
    // --- Appwrite Config ---
    const APPWRITE_ENDPOINT = "https://fra.cloud.appwrite.io/v1";
    const APPWRITE_PROJECT = "684c13530011df315968";
    const APPWRITE_DB_ID = "684c1377001ab5d7cbc9";
    const APPWRITE_COLLECTION_ID = "684c138c000f8065661f";
    const APPWRITE_BUCKET_ID = "6855744e0029b9e00b99";
    const ADMIN_EMAILS = [
      "supremeamerapplications@gmail.com",
      "supremealpha04@gmail.com",
      "supremealpha04@gmail.com",
      "emmyplumbing@gmail.com"
    ];

    const client = new Appwrite.Client();
    client.setEndpoint(APPWRITE_ENDPOINT).setProject(APPWRITE_PROJECT);
    const account = new Appwrite.Account(client);
    const db = new Appwrite.Databases(client);
    const storage = new Appwrite.Storage(client);

    let cars = [];
    let isAdmin = false;

    // --- DARK/LIGHT MODE ---
    function applyTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      localStorage.setItem('theme', theme);
      document.getElementById("themeToggle").innerText = theme === "dark" ? "‚òÄÔ∏è" : "üåô";
    }
    (function(){
      const saved = localStorage.getItem('theme');
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      applyTheme(saved || (prefersDark ? "dark" : "light"));
    })();
    document.getElementById("themeToggle").onclick = function() {
      const current = document.documentElement.getAttribute('data-theme') || 'light';
      applyTheme(current === "dark" ? "light" : "dark");
    };

    // --- Drag & Drop Logic ---
    let selectedFiles = [];
    const dragDropZone = document.getElementById('dragDropZone');
    const fileInput = document.getElementById('carMedia');
    const filePreview = document.getElementById('filePreview');

    function updatePreview() {
      filePreview.innerHTML = "";
      selectedFiles.forEach((f, i) => {
        let preview = "";
        if (f.type.startsWith("image/")) {
          preview = `<img src="${URL.createObjectURL(f)}" alt="media" />`;
        } else if (f.type.startsWith("video/")) {
          preview = `<video src="${URL.createObjectURL(f)}" controls muted></video>`;
        }
        filePreview.innerHTML += `
          <div class="file-preview-item">
            ${preview}
            <button class="remove-btn" title="Remove" onclick="removeSelectedFile(${i})">&times;</button>
          </div>
        `;
      });
    }
    window.removeSelectedFile = function(idx) {
      selectedFiles.splice(idx, 1);
      updatePreview();
    };

    dragDropZone.addEventListener('click', () => fileInput.click());
    dragDropZone.addEventListener('dragover', e => {
      e.preventDefault();
      dragDropZone.classList.add('dragover');
    });
    dragDropZone.addEventListener('dragleave', e => {
      e.preventDefault();
      dragDropZone.classList.remove('dragover');
    });
    dragDropZone.addEventListener('drop', e => {
      e.preventDefault();
      dragDropZone.classList.remove('dragover');
      const files = Array.from(e.dataTransfer.files);
      files.forEach(f => {
        if ((f.type.startsWith("image/") || f.type.startsWith("video/")) && !selectedFiles.some(sf => sf.name === f.name && sf.size === f.size)) {
          selectedFiles.push(f);
        }
      });
      updatePreview();
    });
    fileInput.addEventListener('change', e => {
      Array.from(e.target.files).forEach(f => {
        if ((f.type.startsWith("image/") || f.type.startsWith("video/")) && !selectedFiles.some(sf => sf.name === f.name && sf.size === f.size)) {
          selectedFiles.push(f);
        }
      });
      updatePreview();
    });

    // --- Load Cars from Appwrite ---
    async function loadCars() {
      try {
        const res = await db.listDocuments(
          APPWRITE_DB_ID,
          APPWRITE_COLLECTION_ID,
          [Appwrite.Query.orderDesc("$createdAt")]
        );
        cars = res.documents.map(car => ({
          ...car,
          media: Array.isArray(car.media)
            ? car.media.map(str => {
                try { return JSON.parse(str); } catch { return null; }
              }).filter(Boolean)
            : []
        }));
        renderCars();
        renderAdminCarList();
      } catch (e) {
        document.getElementById('gallery').innerHTML = "<div style='color:#e53935;font-weight:700;'>Failed to load cars.</div>";
        console.error("Loading cars error:", e);
      }
    }

    function renderCars() {
      const gallery = document.getElementById('gallery');
      gallery.innerHTML = "";
      cars.forEach((car, idx) => {
        const delay = 0.08 * idx;
        let cover = "";
        if (car.media && Array.isArray(car.media) && car.media.length) {
          const first = car.media.find(m => m.type === "image") || car.media[0];
          cover = first ? first.url : "";
        }
        const features = car.features ? (Array.isArray(car.features) ? car.features : car.features.split(',')) : [];
        const card = document.createElement('div');
        card.className = "car-card";
        card.style.animationDelay = delay + 's';
        card.innerHTML = `
          <div class="car-img">${cover ? `<img src="${cover}" alt="${car.title}">` : ""}</div>
          <div class="car-content">
            <div class="car-title">${car.title}</div>
            <div class="car-model">${car.model}</div>
            <div class="car-desc">${car.description.slice(0, 84)}...</div>
            <div class="car-features">${features.map(f => `<span>${f.trim()}</span>`).join('')}</div>
            <div class="car-price">${car.price}</div>
            <div class="car-action">
              <button onclick="showCarModal('${car.$id}')">View Details</button>
            </div>
          </div>
        `;
        gallery.appendChild(card);
      });
    }

    function showCarModal(id) {
      const car = cars.find(c => c.$id === id);
      if (!car) return;
      const features = car.features ? (Array.isArray(car.features) ? car.features : car.features.split(',')) : [];
      let gallery = "";
      if (car.media && Array.isArray(car.media)) {
        gallery = `<div class="modal-gallery">` + car.media.map(media => {
          if (media.type === "image") {
            return `<img src="${media.url}" alt="car image" loading="lazy">`;
          } else if (media.type === "video") {
            return `<video src="${media.url}" controls style="background:#222"></video>`;
          }
          return "";
        }).join('') + `</div>`;
      }
      const modalRoot = document.getElementById('modal-root');
      modalRoot.innerHTML = `
        <div class="modal-backdrop" onclick="closeModal(event)">
          <div class="modal" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeModal(event)" title="Close">&times;</button>
            ${gallery}
            <div class="modal-title">${car.title}</div>
            <div class="modal-model">Model Year: ${car.model}</div>
            <div class="modal-price">Price: ${car.price}</div>
            <div class="modal-features">${features.map(f => `<span>${f.trim()}</span>`).join(' ')}</div>
            <div class="modal-desc">${car.description}</div>
            <div class="modal-action">
              <button onclick="closeModal(event)">Close</button>
            </div>
          </div>
        </div>
      `;
      document.body.style.overflow = "hidden";
    }
    function closeModal(e) {
      document.getElementById('modal-root').innerHTML = "";
      document.body.style.overflow = "";
    }

    function scrollToSection(id) {
      const el = document.getElementById(id);
      if (el) el.scrollIntoView({ behavior: "smooth", block: "start" });
    }
    function showAbout() {
      document.getElementById('modal-root').innerHTML = `
        <div class="modal-backdrop" onclick="closeModal(event)">
          <div class="modal" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeModal(event)">&times;</button>
            <img src="https://i.ibb.co/vHgwkF7/supremeamer-ceo.jpg" alt="Supremeamer CEO" class="ceo-photo"/>
            <div class="modal-title" style="margin-bottom:7px;">About Chidoxic Auto Mobile Center</div>
            <div class="modal-desc" style="margin-bottom:7px;">
              <b>Chidoxic Auto Mobile Center</b> is run by <b>Supremeamer (Amadi Chidox)</b>, a passionate entrepreneur and auto expert.<br>
              We provide a modern, responsive and animated online experience for car lovers.
            </div>
            <div class="modal-services">
              <b>Our Services:</b>
              <ul style="margin:0 0 0 17px;">
                <li>Car Sales (New & Used)</li>
                <li>Auto Consultancy</li>
                <li>Car Upgrades & Customization</li>
                <li>Car Sourcing/Importation</li>
                <li>General Auto Maintenance</li>
              </ul>
            </div>
            <div style="font-size:1em;margin-bottom:11px;">
              <b>Why Chidoxic?</b> <br>
              Our gallery showcases only the best, and every vehicle is verified for quality!
            </div>
            <div class="modal-contact-footer">
              <div>
                <b>Contact:</b> supremeamerapplications@gmail.com <br>
                <b>Phone:</b> +234 813 456 7890
              </div>
              <div class="ceo-socials" style="margin-top:8px;">
                <a href="https://wa.me/2348134567890" target="_blank" title="WhatsApp"><span>üü¢</span></a>
                <a href="https://instagram.com/supremeamer" target="_blank" title="Instagram"><span>üì∑</span></a>
                <a href="https://facebook.com/chidoxicsupremeamer" target="_blank" title="Facebook"><span>üìò</span></a>
                <a href="https://twitter.com/supremeamer" target="_blank" title="Twitter"><span>üê¶</span></a>
              </div>
            </div>
            <div class="modal-action"><button onclick="closeModal(event)">Close</button></div>
          </div>
        </div>
      `;
      document.body.style.overflow = "hidden";
    }
    function showContact() {
      document.getElementById('modal-root').innerHTML = `
        <div class="modal-backdrop" onclick="closeModal(event)">
          <div class="modal" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeModal(event)">&times;</button>
            <div class="modal-title">Contact Us</div>
            <div class="modal-desc" style="margin-bottom:16px;">
              <b>Looking for a car or need more details?</b> <br>
              Email: <a href="mailto:info@chidoxicauto.com" style="color:#3167e6;">info@chidoxicauto.com</a><br>
              Phone: <a href="tel:+2348134567890" style="color:#3167e6;">+234 813 456 7890</a><br>
              Location: 123 Dream Cars Blvd, Auto City, Nigeria
            </div>
            <div class="modal-action"><button onclick="closeModal(event)">Close</button></div>
          </div>
        </div>
      `;
      document.body.style.overflow = "hidden";
    }

    function toggleAdminPanel() {
      if (isAdmin) {
        document.getElementById('adminPanel').classList.toggle('active');
      } else {
        showAdminLogin();
      }
    }
    function showAdminLogin() {
      document.getElementById('modal-root').innerHTML = `
        <div class="modal-backdrop" onclick="closeModal(event)">
          <div class="modal" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeModal(event)">&times;</button>
            <div class="modal-title">Admin Login</div>
            <form id="adminLoginForm" style="margin-top:17px;">
              <label>Email</label>
              <input type="email" id="adminEmail" required style="width:100%;padding:8px;border-radius:6px;border:1px solid #c7d1eb;">
              <label style="margin-top:8px;">Password</label>
              <input type="password" id="adminPassword" required style="width:100%;padding:8px;border-radius:6px;border:1px solid #c7d1eb;">
              <button style="margin-top:14px;width:100%;background:#3167e6;color:#fff;padding:10px;border:none;border-radius:6px;font-weight:700;cursor:pointer;">Login</button>
              <div id="loginMsg" style="color:#e53935;margin-top:8px;"></div>
            </form>
          </div>
        </div>
      `;
      document.body.style.overflow = "hidden";
      document.getElementById('adminLoginForm').onsubmit = async function(e) {
        e.preventDefault();
        const email = document.getElementById('adminEmail').value.trim();
        const password = document.getElementById('adminPassword').value;
        if (!ADMIN_EMAILS.includes(email)) {
          document.getElementById('loginMsg').innerText = "Not authorized.";
          return;
        }
        try {
          await account.createEmailSession(email, password);
          isAdmin = true;
          closeModal();
          document.getElementById('adminPanel').classList.add('active');
        } catch (err) {
          document.getElementById('loginMsg').innerText = "Login failed. Check email and password.";
        }
      }
    }
    async function logoutAdmin() {
      try { await account.deleteSession('current'); } catch {}
      isAdmin = false;
      document.getElementById('adminPanel').classList.remove('active');
    }

    // --- Admin Add Car Logic with sold ---
    document.getElementById('adminForm').onsubmit = async function(e) {
      e.preventDefault();
      const title = document.getElementById('carTitle').value.trim();
      const model = document.getElementById('carModel').value.trim();
      const price = document.getElementById('carPrice').value.trim();
      const description = document.getElementById('carDesc').value.trim();
      const features = document.getElementById('carFeatures').value.trim().split(',').map(f=>f.trim()).filter(Boolean);
      if (!title || !model || !price || !description || !features.length) {
        document.getElementById('adminMsg').innerText = "All fields are required.";
        return;
      }
      if (selectedFiles.length < 2) {
        document.getElementById('adminMsg').innerText = "Please upload at least 2 images or videos.";
        return;
      }
      document.getElementById('adminMsg').innerText = "Uploading files...";
      try {
        let mediaArr = [];
        for (let file of selectedFiles) {
          let uploadRes = await storage.createFile(APPWRITE_BUCKET_ID, Appwrite.ID.unique(), file);
          let url = storage.getFilePreview(APPWRITE_BUCKET_ID, uploadRes.$id).href;
          let type = file.type.startsWith('image/') ? 'image' : (file.type.startsWith('video/') ? 'video' : 'other');
          mediaArr.push(JSON.stringify({ url, type, name: file.name }));
        }
        await db.createDocument(
          APPWRITE_DB_ID,
          APPWRITE_COLLECTION_ID,
          Appwrite.ID.unique(),
          {
            title,
            model,
            price,
            description,
            features,
            media: mediaArr,
            sold: false // <-- ADDED: This fixes the "Missing required attribute 'sold'" error!
          }
        );
        document.getElementById('adminMsg').innerText = "Car added successfully!";
        selectedFiles = [];
        updatePreview();
        loadCars();
        this.reset();
      } catch (err) {
        document.getElementById('adminMsg').innerText = "Failed to add car.";
        console.error(err);
      }
    }

    function renderAdminCarList() {
      if (!isAdmin) return;
      let html = "<div style='margin-bottom:10px;font-weight:700;'>All Cars</div>";
      if (!cars.length) html += "<div>No cars found.</div>";
      else cars.forEach(car => {
        html += `<div class="admin-car-title">${car.title} (${car.model}) - <span style="color:#3167e6;">${car.price}</span></div>`;
      });
      document.getElementById('adminList').innerHTML = html;
    }

    // Footer year
    document.getElementById('year').innerText = new Date().getFullYear();

    function showTerms(e) {
      if(e) e.preventDefault();
      document.getElementById('modal-root').innerHTML = `
        <div class="modal-backdrop" onclick="closeModal(event)">
          <div class="modal" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeModal(event)">&times;</button>
            <div class="modal-title">Terms & Conditions</div>
            <div class="modal-desc" style="margin-bottom:18px;max-width:480px;">
              By using this website, you agree to our terms: All car listings are for showcase purposes only.
              No purchase or transaction is guaranteed through this site. Contact us directly for all business dealings.
              We reserve the right to update these terms at any time.
            </div>
            <div class="modal-action"><button onclick="closeModal(event)">Close</button></div>
          </div>
        </div>
      `;
      document.body.style.overflow = "hidden";
    }
    function showPrivacy(e) {
      if(e) e.preventDefault();
      document.getElementById('modal-root').innerHTML = `
        <div class="modal-backdrop" onclick="closeModal(event)">
          <div class="modal" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeModal(event)">&times;</button>
            <div class="modal-title">Privacy Policy</div>
            <div class="modal-desc" style="margin-bottom:18px;max-width:480px;">
              We respect your privacy. No personal information is collected unless you contact us directly.
              Cookies may be used for analytics and site improvement.
              Your data is never sold or shared with third parties.
            </div>
            <div class="modal-action"><button onclick="closeModal(event)">Close</button></div>
          </div>
        </div>
      `;
      document.body.style.overflow = "hidden";
    }

    (async function(){
      try {
        const session = await account.get();
        if (session && ADMIN_EMAILS.includes(session.email)) {
          isAdmin = true;
          document.getElementById('adminPanel').classList.add('active');
        }
      } catch {}
      loadCars();
    })();
  </script>
</body>
</html>
