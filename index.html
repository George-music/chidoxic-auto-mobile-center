<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Chidoxic Auto Mobile Center</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #3c5edb;
      --secondary: #ffe36b;
      --accent: #ffefb4;
      --danger: #e53935;
      --bg: #f9fbff;
      --dark-bg: #18192e;
      --dark-card: #23243b;
      --text: #1a2233;
      --text-light: #e3e7fa;
      --shadow: 0 8px 38px #3c5edb13;
    }
    html, body { margin:0; padding:0; min-height:100vh; }
    body {
      font-family: 'Inter', Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      transition: background .3s, color .3s;
    }
    [data-theme="dark"], body.dark {
      background: var(--dark-bg);
      color: var(--text-light);
    }
    .appbar {
      position: fixed;
      top: 0; left: 0; right: 0;
      z-index: 1001;
      background: var(--primary);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 18px;
      height: 60px;
      max-width: 100vw;
      box-shadow: 0 4px 32px #3c5edb44;
      transition: height .2s;
    }
    .appbar-title {
      font-size: 1.2em; font-weight:900; letter-spacing:1.1px; display:flex; align-items:center; gap:9px;
    }
    .logo {
      width: 30px; height: 30px; border-radius: 50%; margin-right:7px;
      background: #fff;
      border: 2px solid #3c5edb;
    }
    .appbar-btns {
      display: flex; align-items: center; gap: 0;
    }
    .appbar-btns button {
      background: #fff1;
      border: none;
      color: #fff;
      font-size: 1em;
      margin-left: 8px;
      font-weight: 600;
      padding: 9px 15px;
      border-radius: 8px;
      cursor: pointer;
      transition: background .18s, color .18s, transform .13s;
      outline: none;
      box-shadow: 0 2px 6px #3c5edb20;
      min-width: 42px;
      min-height: 42px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .appbar-btns button.theme-toggle {
      font-size: 1.18em;
      padding: 7px 11px;
      background: transparent;
      border: 2px solid #ffe36b88;
      margin-left: 7px;
    }
    .appbar-btns button:active {
      background: var(--secondary);
      color: var(--primary);
      transform: scale(0.96);
    }
    .appbar-btns button:hover {
      background: #fff;
      color: var(--primary);
      transform: scale(1.04);
    }

    @media (max-width: 700px) {
      .appbar {
        flex-direction: column;
        align-items: stretch;
        height: auto;
        padding: 0;
        min-height: unset;
        gap: 0;
      }
      .appbar-title {
        font-size: 1em;
        flex-direction: row;
        justify-content: center;
        padding: 7px 0 2px 0;
      }
      .appbar-btns {
        width: 100%;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 6px;
        padding-bottom: 7px;
        margin-top: 0;
      }
      .appbar-btns button {
        margin-left: 0;
        margin-right: 7px;
        margin-bottom: 4px;
        min-width: 46vw;
        width: 98vw;
        max-width: 310px;
        font-size: 1.09em;
        padding: 13px 0;
        border-radius: 10px;
      }
      .appbar-btns button.theme-toggle {
        min-width: 48px;
        width: 48px;
        padding: 10px 0;
        font-size: 1.20em;
        margin-left: 0;
      }
    }

    @media (max-width: 470px) {
      .appbar-title { font-size: 0.98em; }
      .logo { width: 22px; height: 22px; }
      .appbar-btns button { font-size: 0.97em; }
    }

    .main {
      max-width: 1180px;
      margin: 75px auto 32px auto;
      padding: 0 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .hero {
      max-width: 900px;
      margin: 0 auto 30px auto;
      text-align: center;
      padding: 30px 10px 26px 10px;
      background: linear-gradient(100deg,#f9fbff 65%, #e3ebff 100%);
      border-radius: 18px;
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      overflow: hidden;
    }
    .hero-title { font-size: 1.5em; color: var(--primary); font-weight: 800; margin-bottom: 10px; line-height:1.13;}
    .hero-desc { color: #333; font-size: 1.05em; margin-bottom: 18px; font-weight: 500; }
    .hero-action {
      margin-top: 6px;
      background: var(--primary); color: #fff; font-weight:700; border:none;
      padding:13px 33px; border-radius:9px; font-size:1.13em; cursor:pointer; box-shadow:0 3px 10px #3c5edb22;
      transition: background .2s, color .2s;
    }
    .hero-action:hover { background: var(--text); color:var(--secondary);}
    .hero-img img { width: 180px; border-radius: 8px; box-shadow: 0 8px 32px #3c5edb13; margin-top: 22px;}
    @media (max-width:600px){
      .main {padding:0 2px;}
      .hero{padding:12px 2vw;}
      .hero-title{font-size:1.06em;}
      .hero-img img{width:120px;}
    }

    .car-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(270px,1fr));
      gap: 18px;
      max-width:1200px;
      margin:24px auto 40px auto;
      padding:0 1vw;
      width: 100%;
    }
    .car-card {
      background: #fff; border-radius:14px; box-shadow: var(--shadow);
      overflow:hidden; display:flex; flex-direction:column; position:relative;
      cursor:pointer; transition: box-shadow .23s, transform .23s;
    }
    .car-card:hover { box-shadow:0 16px 48px #3c5edb33; transform:scale(1.025) rotateZ(-1.1deg);}
    .car-img {
      width: 100%; background: #efeffb; display: flex; align-items:center; justify-content:center; min-height: 150px;
      overflow:hidden;
    }
    .car-img img { max-width:100%; max-height:160px; border-radius:12px; margin: 0 auto; display:block; box-shadow:0 2px 9px #3c5edb12; }
    .car-content { padding: 15px 13px 12px 13px; position:relative;}
    .car-title { font-weight:800; font-size:1.09em; color:var(--primary);}
    .car-model, .car-features { font-size:0.99em; color:#3c5edb; margin: 5px 0;}
    .car-desc { font-size:0.99em; color:#333; margin-top:7px; }
    .car-price { font-size:1.06em; font-weight:700; color: #e58f00; margin-top:8px;}
    .car-action {margin-top:8px;}
    .car-action button {
      background: var(--primary); color: #fff; border-radius: 7px; border: none;
      padding: 7px 20px; font-weight:700; font-size:1em; cursor:pointer;
      transition: background .18s, color .18s;
    }
    .car-action button:hover { background: var(--secondary); color: var(--primary);}
    @media (max-width:600px){
      .car-list{grid-template-columns:1fr;}
      .car-card{padding:0;}
      .car-content{padding:11px 5px 9px 5px;}
    }
    .modal-backdrop {
      position:fixed; left:0; top:0; width:100vw; height:100vh; background:rgba(26,34,51,0.18); z-index:999;
      display:flex; align-items:center; justify-content:center;
    }
    .modal {
      background:#fff; border-radius:16px; max-width:95vw; max-height:93vh; overflow-y:auto;
      box-shadow:0 16px 60px 0 rgba(49,103,230,0.18); padding:27px 18px 17px 18px; position:relative;
      min-width:260px;
    }
    .modal-close {
      position: absolute; top: 11px; right: 16px;
      font-size: 1.4rem;
      color: var(--primary);
      background: none; border: none; cursor: pointer;
      font-weight: 800;
      transition: color .17s;
    }
    .modal-close:hover { color: #e53935; }
    .modal-gallery {
      display: flex; flex-wrap: wrap; gap: 9px; justify-content: center; margin-bottom: 14px;
    }
    .modal-gallery img, .modal-gallery video {
      border-radius: 7px; max-width: 110px; max-height: 80px; object-fit: cover;
      background: #e3ebff;
    }
    .modal-title { font-size: 1.1em; font-weight: 800; margin-bottom: 2px; color: var(--primary);}
    .modal-model { color: var(--primary); font-size: 1em; font-weight: 700; margin-bottom: 5px; }
    .modal-price { font-size: 1.07em; font-weight: 700; color: #e58f00; margin-bottom: 5px; }
    .modal-desc { color: #444e62; font-size: 0.99em; margin-bottom: 12px; }
    .modal-features { margin-bottom: 8px; }
    .modal-features span { background: #e3ebff; color: var(--primary); font-weight: 500; border-radius: 5px; padding: 1.5px 9px; font-size: 1em; margin-right: 6px; margin-bottom: 4px; display: inline-block;}
    .modal-action { text-align: right; }
    .modal-action button { background: var(--primary); color: #fff; border: none; font-size: 1em; font-weight: 700; padding: 8px 19px; border-radius: 7px; cursor: pointer; transition: background .2s, transform .14s; margin:0; }
    .modal-action button:hover { background: var(--secondary); color: var(--primary);}
    .footer {
      background: #f1f2f7;
      color: #333;
      text-align: center;
      padding: 16px 3vw 16px 3vw;
      font-size: 1.01em;
      margin-top: 32px;
      border-top: 1px solid #e5e8f0;
      width: 100%;
    }
    .footer a { color: #3c5edb; text-decoration: underline; margin: 0 7px;}
    .footer .designer { font-weight:700; color: #2345a9;}
    .footer-links { margin-top:7px; font-size:.99em; }
    @media (max-width:600px){
      .footer{padding:8px 1vw;font-size:.98em;}
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/appwrite@13.0.1"></script>
</head>
<body>
  <nav class="appbar">
    <span class="appbar-title">
      <img src="https://i.ibb.co/4W2DGKm/car-logo.png" class="logo" alt="Chidoxic Logo"/>
      Chidoxic Auto Mobile Center
    </span>
    <span class="appbar-btns">
      <button onclick="scrollToSection('gallery')">Browse Cars</button>
      <button onclick="showAbout()">About</button>
      <button onclick="showContact()">Contact</button>
      <button class="theme-toggle" id="themeToggle" title="Toggle dark/light mode">🌙</button>
      <button id="adminBtn" onclick="toggleAdminPanel()">Admin</button>
    </span>
  </nav>
  <main class="main">
    <section class="hero" id="hero">
      <div class="hero-content">
        <div class="hero-title">Find Your Dream Car</div>
        <div class="hero-desc">
          Explore a curated selection of the latest and greatest cars.<br>
          Modern UI. Smooth transitions. Details that matter.<br>
          <b>Discover your next ride today!</b>
        </div>
        <button class="hero-action" onclick="scrollToSection('gallery')">View Cars</button>
      </div>
      <div class="hero-img">
        <img src="https://images.unsplash.com/photo-1503736334956-4c8f8e92946d?auto=format&fit=crop&w=720&q=80" alt="Modern Car"/>
      </div>
    </section>
    <section class="car-list" id="gallery"></section>
    <section class="admin-panel" id="adminPanel">
      <div class="admin-title">Admin Panel</div>
      <form class="admin-form" id="adminForm" autocomplete="off">
        <div class="admin-msg" id="adminMsg"></div>
        <div class="admin-row">
          <label for="carTitle">Title</label>
          <input type="text" id="carTitle" required>
        </div>
        <div class="admin-row">
          <label for="carModel">Model Year</label>
          <input type="text" id="carModel" required>
        </div>
        <div class="admin-row">
          <label for="carPrice">Price</label>
          <input type="text" id="carPrice" required>
        </div>
        <div class="admin-row">
          <label for="carDesc">Description</label>
          <textarea id="carDesc" required></textarea>
        </div>
        <div class="admin-row">
          <label for="carMedia">Images & Video (drag and drop or click, min 2 files)</label>
          <div id="dragDropZone" class="drag-drop-zone" style="background:#f4f7ff;padding:15px;text-align:center;border:2px dashed #3c5edb;border-radius:8px;cursor:pointer;">Drag & drop files here or click to select</div>
          <input type="file" id="carMedia" accept="image/*,video/*" multiple style="display:none" />
          <div class="file-list-preview" id="filePreview"></div>
        </div>
        <div class="admin-row">
          <label for="carFeatures">Features (comma separated)</label>
          <input type="text" id="carFeatures" required>
        </div>
        <button type="submit">Add Car</button>
      </form>
      <button class="admin-logout" id="adminLogout" onclick="logoutAdmin()">Logout</button>
      <div class="admin-list" id="adminList"></div>
    </section>
  </main>
  <div id="modal-root"></div>
  <footer class="footer">
    <div>
      &copy; <span id="year"></span> Chidoxic Auto Mobile Center.<br>
      <span class="footer-links">
        <a href="#" onclick="showTerms(event)">Terms &amp; Conditions</a> |
        <a href="#" onclick="showPrivacy(event)">Privacy Policy</a>
      </span><br>
      <span>Designed by <span class="designer">Supremeamer</span></span>
    </div>
  </footer>
  <script>
    // --- Appwrite Config ---
    const APPWRITE_ENDPOINT = "https://fra.cloud.appwrite.io/v1";
    const APPWRITE_PROJECT = "684c13530011df315968";
    const APPWRITE_DB_ID = "684c1377001ab5d7cbc9";
    const APPWRITE_COLLECTION_ID = "684c138c000f8065661f";
    const APPWRITE_BUCKET_ID = "6855744e0029b9e00b99";
    const ADMIN_EMAILS = [
      "supremeamerapplications@gmail.com",
      "supremealpha04@gmail.com",
      "supremealpha04@gmail.com"
    ];

    const client = new Appwrite.Client();
    client.setEndpoint(APPWRITE_ENDPOINT).setProject(APPWRITE_PROJECT);
    const account = new Appwrite.Account(client);
    const db = new Appwrite.Databases(client);
    const storage = new Appwrite.Storage(client);

    let cars = [];
    let isAdmin = false;

    // --- DARK/LIGHT MODE ---
    function applyTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      localStorage.setItem('theme', theme);
      document.getElementById("themeToggle").innerText = theme === "dark" ? "☀️" : "🌙";
    }
    (function(){
      const saved = localStorage.getItem('theme');
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      applyTheme(saved || (prefersDark ? "dark" : "light"));
    })();
    document.getElementById("themeToggle").onclick = function() {
      const current = document.documentElement.getAttribute('data-theme') || 'light';
      applyTheme(current === "dark" ? "light" : "dark");
    };

    // --- Drag & Drop Logic ---
    let selectedFiles = [];
    const dragDropZone = document.getElementById('dragDropZone');
    const fileInput = document.getElementById('carMedia');
    const filePreview = document.getElementById('filePreview');

    function updatePreview() {
      filePreview.innerHTML = "";
      selectedFiles.forEach((f, i) => {
        let preview = "";
        if (f.type.startsWith("image/")) {
          preview = `<img src="${URL.createObjectURL(f)}" alt="media" style="max-width:60px;max-height:60px;border-radius:7px;" />`;
        } else if (f.type.startsWith("video/")) {
          preview = `<video src="${URL.createObjectURL(f)}" controls muted style="max-width:60px;max-height:60px;border-radius:7px;"></video>`;
        }
        filePreview.innerHTML += `
          <div class="file-preview-item" style="display:inline-block;position:relative;margin-right:6px;">
            ${preview}
            <button class="remove-btn" title="Remove" onclick="removeSelectedFile(${i})" style="position:absolute;top:-7px;right:-7px;background:#e53935;color:#fff;border:none;border-radius:50%;width:18px;height:18px;cursor:pointer;">&times;</button>
          </div>
        `;
      });
    }
    window.removeSelectedFile = function(idx) {
      selectedFiles.splice(idx, 1);
      updatePreview();
    };

    dragDropZone.addEventListener('click', () => fileInput.click());
    dragDropZone.addEventListener('dragover', e => {
      e.preventDefault();
      dragDropZone.classList.add('dragover');
    });
    dragDropZone.addEventListener('dragleave', e => {
      e.preventDefault();
      dragDropZone.classList.remove('dragover');
    });
    dragDropZone.addEventListener('drop', e => {
      e.preventDefault();
      dragDropZone.classList.remove('dragover');
      const files = Array.from(e.dataTransfer.files);
      files.forEach(f => {
        if ((f.type.startsWith("image/") || f.type.startsWith("video/")) && !selectedFiles.some(sf => sf.name === f.name && sf.size === f.size)) {
          selectedFiles.push(f);
        }
      });
      updatePreview();
    });
    fileInput.addEventListener('change', e => {
      Array.from(e.target.files).forEach(f => {
        if ((f.type.startsWith("image/") || f.type.startsWith("video/")) && !selectedFiles.some(sf => sf.name === f.name && sf.size === f.size)) {
          selectedFiles.push(f);
        }
      });
      updatePreview();
    });

    // --- Load Cars from Appwrite ---
    async function loadCars() {
      try {
        const res = await db.listDocuments(
          APPWRITE_DB_ID,
          APPWRITE_COLLECTION_ID,
          [Appwrite.Query.orderDesc("$createdAt")]
        );
        cars = res.documents.map(car => ({
          ...car,
          media: Array.isArray(car.media)
            ? car.media.map(str => {
                try { return JSON.parse(str); } catch { return null; }
              }).filter(Boolean)
            : []
        }));
        renderCars();
        renderAdminCarList();
      } catch (e) {
        document.getElementById('gallery').innerHTML = "<div style='color:#e53935;font-weight:700;'>Failed to load cars.</div>";
        console.error("Loading cars error:", e);
      }
    }

    function renderCars() {
      const gallery = document.getElementById('gallery');
      gallery.innerHTML = "";
      cars.forEach((car, idx) => {
        const delay = 0.08 * idx;
        let cover = "";
        if (car.media && Array.isArray(car.media) && car.media.length) {
          const first = car.media.find(m => m.type === "image") || car.media[0];
          cover = first ? first.url : "";
        }
        const features = car.features ? (Array.isArray(car.features) ? car.features : car.features.split(',')) : [];
        const card = document.createElement('div');
        card.className = "car-card";
        card.style.animationDelay = delay + 's';
        card.innerHTML = `
          <div class="car-img">${cover ? `<img src="${cover}" alt="${car.title}">` : ""}</div>
          <div class="car-content">
            <div class="car-title">${car.title}</div>
            <div class="car-model">${car.model}</div>
            <div class="car-desc">${car.description.slice(0, 84)}...</div>
            <div class="car-features">${features.map(f => `<span>${f.trim()}</span>`).join('')}</div>
            <div class="car-price">${car.price}</div>
            <div class="car-action">
              <button onclick="showCarModal('${car.$id}')">View Details</button>
            </div>
          </div>
        `;
        gallery.appendChild(card);
      });
    }

    window.showCarModal = function(id) {
      const car = cars.find(c => c.$id === id);
      if (!car) return;
      const features = car.features ? (Array.isArray(car.features) ? car.features : car.features.split(',')) : [];
      let gallery = "";
      if (car.media && Array.isArray(car.media)) {
        gallery = `<div class="modal-gallery">` + car.media.map(media => {
          if (media.type === "image") {
            return `<img src="${media.url}" alt="car image" loading="lazy">`;
          } else if (media.type === "video") {
            return `<video src="${media.url}" controls style="background:#222"></video>`;
          }
          return "";
        }).join('') + `</div>`;
      }
      const modalRoot = document.getElementById('modal-root');
      modalRoot.innerHTML = `
        <div class="modal-backdrop" onclick="closeModal(event)">
          <div class="modal" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeModal(event)" title="Close">&times;</button>
            ${gallery}
            <div class="modal-title">${car.title}</div>
            <div class="modal-model">Model Year: ${car.model}</div>
            <div class="modal-price">Price: ${car.price}</div>
            <div class="modal-features">${features.map(f => `<span>${f.trim()}</span>`).join(' ')}</div>
            <div class="modal-desc">${car.description}</div>
            <div class="modal-action">
              <button onclick="closeModal(event)">Close</button>
            </div>
          </div>
        </div>
      `;
      document.body.style.overflow = "hidden";
    }
    window.closeModal = function(e) {
      document.getElementById('modal-root').innerHTML = "";
      document.body.style.overflow = "";
    }

    window.scrollToSection = function(id) {
      const el = document.getElementById(id);
      if (el) el.scrollIntoView({ behavior: "smooth", block: "start" });
    }

    // Admin logic (unchanged, keep as in your code)
    // ... (Rest of your modal/about/contact/footer JS, unchanged) ...

    // Footer year
    document.getElementById('year').innerText = new Date().getFullYear();

    // (Your modal-related functions: showTerms, showPrivacy, showAbout, showContact, etc. unchanged)

    // Admin Panel logic
    window.toggleAdminPanel = function() {
      if (isAdmin) {
        document.getElementById('adminPanel').classList.toggle('active');
      } else {
        showAdminLogin();
      }
    }
    function showAdminLogin() {
      document.getElementById('modal-root').innerHTML = `
        <div class="modal-backdrop" onclick="closeModal(event)">
          <div class="modal" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeModal(event)">&times;</button>
            <div class="modal-title">Admin Login</div>
            <form id="adminLoginForm" style="margin-top:17px;">
              <label>Email</label>
              <input type="email" id="adminEmail" required style="width:100%;padding:8px;border-radius:6px;border:1px solid #c7d1eb;">
              <label style="margin-top:8px;">Password</label>
              <input type="password" id="adminPassword" required style="width:100%;padding:8px;border-radius:6px;border:1px solid #c7d1eb;">
              <button style="margin-top:14px;width:100%;background:#3c5edb;color:#fff;padding:10px;border:none;border-radius:6px;font-weight:700;cursor:pointer;">Login</button>
              <div id="loginMsg" style="color:#e53935;margin-top:8px;"></div>
            </form>
          </div>
        </div>
      `;
      document.body.style.overflow = "hidden";
      document.getElementById('adminLoginForm').onsubmit = async function(e) {
        e.preventDefault();
        const email = document.getElementById('adminEmail').value.trim();
        const password = document.getElementById('adminPassword').value;
        if (!ADMIN_EMAILS.includes(email)) {
          document.getElementById('loginMsg').innerText = "Not authorized.";
          return;
        }
        try {
          await account.createEmailSession(email, password);
          isAdmin = true;
          closeModal();
          document.getElementById('adminPanel').classList.add('active');
        } catch (err) {
          document.getElementById('loginMsg').innerText = "Login failed. Check email and password.";
        }
      }
    }
    window.logoutAdmin = async function() {
      try { await account.deleteSession('current'); } catch {}
      isAdmin = false;
      document.getElementById('adminPanel').classList.remove('active');
    }

    // --- Admin Add Car Logic with sold ---
    document.getElementById('adminForm').onsubmit = async function(e) {
      e.preventDefault();
      const title = document.getElementById('carTitle').value.trim();
      const model = document.getElementById('carModel').value.trim();
      const price = document.getElementById('carPrice').value.trim();
      const description = document.getElementById('carDesc').value.trim();
      const features = document.getElementById('carFeatures').value.trim().split(',').map(f=>f.trim()).filter(Boolean);
      if (!title || !model || !price || !description || !features.length) {
        document.getElementById('adminMsg').innerText = "All fields are required.";
        return;
      }
      if (selectedFiles.length < 2) {
        document.getElementById('adminMsg').innerText = "Please upload at least 2 images or videos.";
        return;
      }
      document.getElementById('adminMsg').innerText = "Uploading files...";
      try {
        let mediaArr = [];
        for (let file of selectedFiles) {
          let uploadRes = await storage.createFile(APPWRITE_BUCKET_ID, Appwrite.ID.unique(), file);
          let url = storage.getFilePreview(APPWRITE_BUCKET_ID, uploadRes.$id).href;
          let type = file.type.startsWith('image/') ? 'image' : (file.type.startsWith('video/') ? 'video' : 'other');
          mediaArr.push(JSON.stringify({ url, type, name: file.name }));
        }
        await db.createDocument(
          APPWRITE_DB_ID,
          APPWRITE_COLLECTION_ID,
          Appwrite.ID.unique(),
          {
            title,
            model,
            price,
            description,
            features,
            media: mediaArr,
            sold: false
          }
        );
        document.getElementById('adminMsg').innerText = "Car added successfully!";
        selectedFiles = [];
        updatePreview();
        loadCars();
        this.reset();
      } catch (err) {
        document.getElementById('adminMsg').innerText = "Failed to add car.";
        console.error(err);
      }
    }

    function renderAdminCarList() {
      if (!isAdmin) return;
      let html = "<div style='margin-bottom:10px;font-weight:700;'>All Cars</div>";
      if (!cars.length) html += "<div>No cars found.</div>";
      else cars.forEach(car => {
        html += `<div class="admin-car-title">${car.title} (${car.model}) - <span style="color:#3c5edb;">${car.price}</span></div>`;
      });
      document.getElementById('adminList').innerHTML = html;
    }

    // Footer year
    document.getElementById('year').innerText = new Date().getFullYear();

    function showTerms(e) {
      if(e) e.preventDefault();
      document.getElementById('modal-root').innerHTML = `
        <div class="modal-backdrop" onclick="closeModal(event)">
          <div class="modal" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeModal(event)">&times;</button>
            <div class="modal-title">Terms & Conditions</div>
            <div class="modal-desc" style="margin-bottom:18px;max-width:480px;">
              By using this website, you agree to our terms: All car listings are for showcase purposes only.
              No purchase or transaction is guaranteed through this site. Contact us directly for all business dealings.
              We reserve the right to update these terms at any time.
            </div>
            <div class="modal-action"><button onclick="closeModal(event)">Close</button></div>
          </div>
        </div>
      `;
      document.body.style.overflow = "hidden";
    }
    function showPrivacy(e) {
      if(e) e.preventDefault();
      document.getElementById('modal-root').innerHTML = `
        <div class="modal-backdrop" onclick="closeModal(event)">
          <div class="modal" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeModal(event)">&times;</button>
            <div class="modal-title">Privacy Policy</div>
            <div class="modal-desc" style="margin-bottom:18px;max-width:480px;">
              We respect your privacy. No personal information is collected unless you contact us directly.
              Cookies may be used for analytics and site improvement.
              Your data is never sold or shared with third parties.
            </div>
            <div class="modal-action"><button onclick="closeModal(event)">Close</button></div>
          </div>
        </div>
      `;
      document.body.style.overflow = "hidden";
    }
    function showAbout() {
      document.getElementById('modal-root').innerHTML = `
        <div class="modal-backdrop" onclick="closeModal(event)">
          <div class="modal" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeModal(event)">&times;</button>
            <img src="https://i.ibb.co/vHgwkF7/supremeamer-ceo.jpg" alt="Supremeamer CEO" style="width:76px;height:76px;border-radius:50%;object-fit:cover;margin-bottom:10px;border:2.5px solid #3c5edb;box-shadow:0 2px 8px #3c5edb22;display:block;margin-left:auto;margin-right:auto;" />
            <div class="modal-title" style="margin-bottom:7px;">About Chidoxic Auto Mobile Center</div>
            <div class="modal-desc" style="margin-bottom:7px;">
              <b>Chidoxic Auto Mobile Center</b> is run by <b>Supremeamer (Amadi Chidox)</b>, a passionate entrepreneur and auto expert.<br>
              We provide a modern, responsive and animated online experience for car lovers.
            </div>
            <div style="margin:17px 0 12px 0;text-align:left;font-size:1em;color:#214fa4;background:#e3ebff;border-radius:8px;padding:9px 13px;">
              <b>Our Services:</b>
              <ul style="margin:0 0 0 17px;">
                <li>Car Sales (New & Used)</li>
                <li>Auto Consultancy</li>
                <li>Car Upgrades & Customization</li>
                <li>Car Sourcing/Importation</li>
                <li>General Auto Maintenance</li>
              </ul>
            </div>
            <div style="font-size:1em;margin-bottom:11px;">
              <b>Why Chidoxic?</b> <br>
              Our gallery showcases only the best, and every vehicle is verified for quality!
            </div>
            <div style="margin-top:16px;padding-top:13px;border-top:1.5px solid #e3ebff;font-size:1em;text-align:center;">
              <div>
                <b>Contact:</b> supremeamerapplications@gmail.com <br>
                <b>Phone:</b> +234 813 456 7890
              </div>
              <div style="display:flex;justify-content:center;gap:8px;margin-top:8px;">
                <a href="https://wa.me/2348134567890" target="_blank" title="WhatsApp"><span>🟢</span></a>
                <a href="https://instagram.com/supremeamer" target="_blank" title="Instagram"><span>📷</span></a>
                <a href="https://facebook.com/chidoxicsupremeamer" target="_blank" title="Facebook"><span>📘</span></a>
                <a href="https://twitter.com/supremeamer" target="_blank" title="Twitter"><span>🐦</span></a>
              </div>
            </div>
            <div class="modal-action"><button onclick="closeModal(event)">Close</button></div>
          </div>
        </div>
      `;
      document.body.style.overflow = "hidden";
    }
    function showContact() {
      document.getElementById('modal-root').innerHTML = `
        <div class="modal-backdrop" onclick="closeModal(event)">
          <div class="modal" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeModal(event)">&times;</button>
            <div class="modal-title">Contact Us</div>
            <div class="modal-desc" style="margin-bottom:16px;">
              <b>Looking for a car or need more details?</b> <br>
              Email: <a href="mailto:info@chidoxicauto.com" style="color:#3c5edb;">info@chidoxicauto.com</a><br>
              Phone: <a href="tel:+2348134567890" style="color:#3c5edb;">+234 813 456 7890</a><br>
              Location: 123 Dream Cars Blvd, Auto City, Nigeria
            </div>
            <div class="modal-action"><button onclick="closeModal(event)">Close</button></div>
          </div>
        </div>
      `;
      document.body.style.overflow = "hidden";
    }

    (async function(){
      try {
        const session = await account.get();
        if (session && ADMIN_EMAILS.includes(session.email)) {
          isAdmin = true;
          document.getElementById('adminPanel').classList.add('active');
        }
      } catch {}
      loadCars();
    })();
  </script>
</body>
</html>
